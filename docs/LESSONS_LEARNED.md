# Residue 開発 つまずきメモ（Yozo指摘）

## 2026-02-17

### 1. 画像のアスペクト比間違い
- **症状**: 背景画像を9:16（縦）で生成してしまった
- **Yozo指摘**: 「横画面が基本じゃなかった？」
- **原因**: viewportが1280x720（横画面）なのに縦画像を生成
- **修正**: 16:9で再生成（API追加コスト$0.12）
- **教訓**: project.godotのviewport設定を最初に確認すること

### 2. LINEで画像が見えない
- **症状**: LINE経由で送った画像が表示されない
- **Yozo指摘**: 「画像見えてないけど」「写真見えてないけど」
- **原因**: /tmp のシンボリックリンクが画像再生成時に壊れた（ファイルサイズ17-23bytesに）
- **修正**: シンボリックリンクではなくコピーで対応
- **教訓**: シンボリックリンクは元ファイル上書きで壊れる。cpを使え

### 3. Godot UID手動指定ミス
- **症状**: タイトル画面の背景画像がゲーム内で表示されない
- **原因**: TitleScreen.tscnで`uid://title_bg`と手動で書いたが、Godotが自動生成したUIDは`uid://bodqklgss6p4f`だった
- **修正**: .importファイルから正しいUIDを取得
- **教訓**: **tscnでUIDを手動で書くな。`.import`ファイルから確認するか、コードで`load()`を使え**

### 4. TextureRectがタッチイベントをブロック
- **症状**: 「戦うボタン押しても何も起きない」
- **Yozo指摘**: 「戦う押しても何も起きてない感じ」
- **原因**: 背景画像やシルエット用TextureRectのmouse_filterがデフォルト（STOP）のまま → タッチイベントを吸収してボタンに届かない
- **修正**: 全装飾TextureRectに`mouse_filter = 2`（IGNORE）を設定
- **教訓**: **装飾用のControl系ノードには必ずmouse_filter=IGNOREを設定**

### 5. ボタンdisabledが解除されない
- **症状**: mouse_filter修正後もボタンが反応しない
- **Yozo指摘**: 「戦う押しても周回を終了押してもすすみません」
- **原因**: タイプライター完了シグナル`text_completed`がボタン追加前に同期的に発火 → disabled解除のループが空振り
- **修正1**: ボタン追加をタイプライター開始前に移動（Build 9）→ まだ動かず
- **修正2**: disabled ロジック自体を完全撤廃。ボタンは常にクリック可能に（Build 12）
- **教訓**: **UIの有効/無効を非同期シグナルに依存させるな。シンプルに常時有効にしろ**

### 6. スクロール選択肢のUX
- **症状**: 選択肢がスクロールコンテナ内にあり操作しづらい
- **Yozo指摘**: 「このスクロール形式の選択肢今後禁止にしてください」
- **修正**: ScrollContainer廃止、3択以上は2列GridContainer
- **教訓**: **モバイルでスクロール選択肢は禁止。画面内に全部収めろ**

### 7. ステータス表示が大きすぎ
- **Yozo指摘**: 「一番下のステータス表示はもっと極端に小さくていいです」
- **修正**: フォント18→12、色を薄く、「周回を終了」ボタンも小型化
- **教訓**: **ステータス情報は極力控えめに。メインコンテンツの邪魔をしない**

### 8. ストーリーの展開が薄い
- **Yozo指摘**: 「一つ一つの話が一回でほぼ完結していたり、話に展開がないこと」
- **対応**: ストーリーレビュー用サブエージェント起動、AI分析中
- **教訓**: **イベントは単発完結にせず、伏線→展開→回収のサイクルを意識**

### 9. GDScriptでPython構文を使ってしまう
- **症状**: ゲームがスタート後に動かなくなった
- **原因**: フィードバック機能で`text[:100]`（Pythonスライス）を書いた。GDScriptでは`substr(0, 100)`
- **修正**: `substr()`に置き換え
- **教訓**: **GDScriptはPythonに似てるが別言語。スライス、リスト内包表記、f-string等は使えない**

---

## パターン認識
- **Godot固有の罠**: UID手動指定、mouse_filter、シグナルタイミング
- **モバイルUX**: スクロール禁止、タッチ対応（InputEventScreenTouch）、控えめなUI
- **画像生成**: アスペクト比は用途に合わせて（ゲーム=16:9、シルエット=9:16）
- **ファイル管理**: シンボリックリンクよりコピー
