# なぜバックエンドが必要か — JSON管理の根本的問題

## 前提
Residueは現在、全シナリオ・イベント・会話を `data/events/events.json`（1618行）に静的JSONとして持ち、アプリにバンドルしている。

## 問題：コンセプトの根幹を揺るがす

### 1. 「動的増殖」が実現できない
GDDの核心は「行動ログ → タグ化 → テンプレ差分生成」による動的コンテンツ増殖。JSONハードコードではこのパイプラインが成立しない。

- `ReactionEngine` が会話差分を生成 → **保存先がない**
- `ProgressionEngine` が世界変化を判定 → **反映先がない**
- プレイヤーの因果タグに応じた差分生成 → **ビルド時に全パターン用意するのは不可能**

### 2. クロスワールド因果リンクが死ぬ
「別世界で取得した鍵が、この世界で意味を持つ」——これがResidueの体験の柱。だが：

- 静的JSONでは全組み合わせを事前に書き切る必要がある
- 世界が増えるほど組み合わせ爆発（2世界でも数十パターン、3世界で数百）
- 「改変シナリオ」を正史の派生レイヤーとして管理する仕組みがない

### 3. コンテンツ追加 = アプリ更新
JSONがアプリにバンドルされている以上：

- 新イベント追加 → ビルド → TestFlight/App Store審査 → ユーザーに届くまで数日
- ホットフィックス（誤字、バランス調整）も同じ工程
- ライブ運用が事実上不可能

### 4. パーソナライゼーションができない
GDDが目指す「プレイヤーごとに異なる体験」：

- 因果タグに基づく差分会話 → 全パターンをJSONに書くのは非現実的
- 「前の死が次に意味を持つ」感覚 → プレイデータに応じた動的生成が必要
- 将来的なAI生成テキスト統合 → サーバーサイド処理が必須

### 5. スケーラビリティの壁
現在1618行で2世界分。GDDの構想通りに拡張すると：

- 世界数増加（3→5→10）
- 各世界のイベント深化
- クロスワールドリンク
- 周回差分（ループ数に応じた反応）
- → **1ファイルで管理不能になるのは時間の問題**

## バックエンドで解決できること

| 問題 | バックエンド解決策 |
|------|-------------------|
| 動的増殖 | サーバーサイドでタグ→差分生成、D1/R2にキャッシュ |
| クロスワールドリンク | DBでフラグ管理、動的にイベント条件評価 |
| コンテンツ更新 | サーバー側JSON更新のみ、アプリ再ビルド不要 |
| パーソナライゼーション | プレイデータをDBに蓄積、API経由で個別差分返却 |
| スケーラビリティ | イベントをDB化、クエリで必要分だけ取得 |

## 想定アーキテクチャ（Cloudflare）
- **Workers**: APIエンドポイント（イベント取得、差分生成）
- **D1**: イベント・フラグ・プレイデータのDB
- **R2**: 画像・音声アセットの配信
- **KV**: セッション管理、キャッシュ

## まとめ
JSONによる静的シナリオ管理は、GDDが掲げる「死と継承を繰り返すほど世界が変わる」体験を**構造的に実現不可能**にしている。バックエンド導入はオプションではなく、Residueのコンセプトを実現するための**必須条件**。
